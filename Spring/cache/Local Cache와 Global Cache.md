- [[#캐시(Cache)|캐시(Cache)]]
	- [[#캐시(Cache)#캐시란 무엇인가?|캐시란 무엇인가?]]
	- [[#캐시(Cache)#캐시 특징|캐시 특징]]
	- [[#캐시(Cache)#캐시 장단점|캐시 장단점]]
	- [[#캐시(Cache)#캐시에 적합한 데이터 종류|캐시에 적합한 데이터 종류]]
	- [[#캐시(Cache)#캐시에 적합하지 않는 데이터 종류|캐시에 적합하지 않는 데이터 종류]]
- [[#로컬 캐시 및 글로벌 캐시|로컬 캐시 및 글로벌 캐시]]
	- [[#로컬 캐시 및 글로벌 캐시#로컬 캐시는 무엇인가?|로컬 캐시는 무엇인가?]]
	- [[#로컬 캐시 및 글로벌 캐시#로컬 캐시의 특징|로컬 캐시의 특징]]
	- [[#로컬 캐시 및 글로벌 캐시#로컬 캐시의 장점|로컬 캐시의 장점]]
	- [[#로컬 캐시 및 글로벌 캐시#로컬 캐시의 단점|로컬 캐시의 단점]]
	- [[#로컬 캐시 및 글로벌 캐시#글로벌 캐시는 무엇인가?|글로벌 캐시는 무엇인가?]]
	- [[#로컬 캐시 및 글로벌 캐시#글로벌 캐시의 특징|글로벌 캐시의 특징]]
	- [[#로컬 캐시 및 글로벌 캐시#글로벌 캐시의 장점|글로벌 캐시의 장점]]
	- [[#로컬 캐시 및 글로벌 캐시#글로벌 캐시의 단점|글로벌 캐시의 단점]]
	- [[#로컬 캐시 및 글로벌 캐시#로컬 캐시 vs 글로벌 캐시|로컬 캐시 vs 글로벌 캐시]]
- [[#Cache & Data Store 배치 전략 - 읽기|Cache & Data Store 배치 전략 - 읽기]]
	- [[#Cache & Data Store 배치 전략 - 읽기#Cache Aside|Cache Aside]]
	- [[#Cache & Data Store 배치 전략 - 읽기#Read-Through|Read-Through]]
- [[#Cache & Data Store 배치 전략 - 쓰기|Cache & Data Store 배치 전략 - 쓰기]]
	- [[#Cache & Data Store 배치 전략 - 쓰기#Write Back (Write Behind)|Write Back (Write Behind)]]
	- [[#Cache & Data Store 배치 전략 - 쓰기#Write Through|Write Through]]
	- [[#Cache & Data Store 배치 전략 - 쓰기#Write Around|Write Around]]
- [[#References|References]]

## 캐시(Cache)
### 캐시란 무엇인가?
**캐시(Cache)란 자주 사용하는 데이터나 값을 임시적으로 저장하는 공간을 의미합니다.** 캐시를 사용하는 이유는 접근 속도를 높이고 성능을 최적화하기 위해서 사용합니다. 대표적으로 CPU 캐시, 웹 브라우저 캐시, 메모리 캐시 등이 있습니다.

캐시 공간이 필요한 이유는 무엇인가?
- 저장 장치간에 속도 차이를 줄이기 위해서 캐시가 필요합니다.
- 자주 사용하는 데이터는 캐시에 저장하여 반복 조회를 방지하고 성능을 높힙니다.
- 네트워크 및 데이터베이스 부하를 줄이고, 비용을 절감하는데 기여합니다.
- 빠른 응답 속도를 통해서 사용자 경험을 개선시키고 지연 시간을 단축시킬 수 있습니다.

### 캐시 특징
- 캐시는 자주 사용하는 데이터를 저장하여 다시 요청할 때 빠르게 제공할 수 있습니다.
- 캐시는 영구적인 저장소가 아니기 때문에 일정시간이 지나면 삭제되거나 덮어씌워지는 임시 저장소입니다.
- 캐시는 여러 계층에서 사용될 수 있습니다. 대표적으로 CPU 캐시, 메모리 캐시, 디스크 캐시 등이 있습니다.
- 캐시는 읽기 성능을 극대화하는 용도로 사용하지만, 쓰기 연산 수행할 때는 동기화 문제가 발생할 수 있습니다. 예를 들어 원본 데이터가 변경되었을 때, 캐시된 데이터가 즉시 갱신되지 않으면 오래된 데이터를 제공할 위험이 있습니다.

### 캐시 장단점
장점
- 빠른 데이터 접근 속도
	- 데이터베이스, 디스크, 네트워크보다 훨씬 빠르게 데이터를 제공할 수 있습니다.
	- CPU 캐시 > RAM 캐시 > 디스크 캐시 순으로 속도가 빠릅니다.
- 서버 부하 감소
	- 동일한 요청이 반복되는 경우에 캐시를 사용하면, 데이터베이스 또는 원격 서버에 불필요한 요청을 줄일 수 있습니다.
	- 예를 들어 API 서버에서 외부 API의 응답을 캐싱하여 응답 속도를 향상시킬 수 있습니다.
- 응답 속도 향상
	- 캐시를 사용하여 응답 속도를 향상시켜 웹 사이트의 페이지 로딩 속도를 단축시킬 수 있습니다.
	- 예를 들어 자주 방문하는 웹사이트는 캐시를 활용하여 새로고침 시 빠르게 로딩되게 합니다.
- 네트워크 트래픽 감소
	- 동일 요청이 반복되는 경우 네트워크를 통해서 데이터를 가져올 필요가 없어 대역폭을 절약합니다.
	- 예를 들어 CDN을 이용하면 정적 파일을 사용자와 가까운 서버에서 제공하여 네트워크 비용을 절감합니다.
- TTL 설정 가능
	- 특정 데이터의 유효기간을 설정해서 불필요한 캐시 사용을 방지할 수 있습니다.
	- 예를 들어 주가 데이터는 10초마다 업데이트하고 뉴스 데이터는 1시간 마다 갱신하기 위해서 TTL을 설정할 수 있습니다.
단점
- 데이터 불일치 문제 발생
	- 원본 데이터가 변경되었을 때, 캐시 데이터가 즉시 반영되지 않으면 오래된 데이터를 반환할 위험이 있습니다.
	- 데이터 불일치 문제를 해결하기 위해서는 TTL 설정, 캐시 무효화(캐시 삭제), **Write-Through** 전략 사용
- 메모리 사용량 증가
	- 캐시는 보통 메모리에 저장되므로, 데이터가 많아질수록 메모리 사용량이 증가됩니다.
	- 메모리 사용량 증가 문제를 해결하기 위해서 Least Recently Used(LRU) 방식으로 오래된 데이터를 삭제할 수 있습니다.
- 캐시 무효화 관리 필요
	- 캐시를 갱신해야 할 때, 언제 삭제할것인지 결정하는 정책이 필요합니다.
	- 예를 들어 사용자 프로필 정보가 변경되었을 때 캐시를 무효화하지 않으면, 변경된 내용이 반영되지 않습니다.
- 초기 로딩 시 지연 발생(Cold Cache 문제)
	- 캐시는 초기에 비어 있기 때문에 처음 요청할 때는 원본 데이터를 조회해야 합니다.
	- Cold Cache 문제를 해결하기 위해서 Warm-up 캐싱을 적용하여 초기 로딩 속도를 개선할 수 있습니다.
- 쓰기 연산 오버헤드 발생 가능
	- Write-Through 캐시 전략을 사용할 경우 캐시와 데이터베이스를 동시에 업데이트해야 하므로 성능 저하 가능
	- 위와 같은 문제를 해결하기 위해서 쓰기 작업이 적은 데이터(읽기 중심 데이터)를 캐싱하는 것이 효율적입니다.

캐시의 장단점을 요약한 표는 다음과 같습니다.

| 구분      | 장점                       | 단점                                   |
| ------- | ------------------------ | ------------------------------------ |
| 속도      | 빠른 데이터 조회 및 응답 속도 향상     | 초기 로딩이 느릴 수 있음(Cold Cache)           |
| 서버 부하   | DB 및 API 요청 감소, 서버 부담 경감 | 캐시된 데이터가 많아질수록 메모리 부담 증가             |
| 트래픽     | 네트워크 요청 최소화(CDN 등 활용)    | 캐시 데이터가 많으면 캐시 관리 정책이 필요함            |
| 데이터 일관성 | 자주 변경되지 않는 데이터에 적합함      | 원본 데이터 변경시 캐시 갱신 문제가 발생함(Stale Data) |
| 운영 관리   | TTL 설정으로 자동 만료 기능        | 캐시 무효화 정책 필요함                        |
| 쓰기 성능   | 읽기 중심 데이터는 성능 향상됨        | Write-Through 방식은 쓰기 성능 저하가 가능함      |

### 캐시에 적합한 데이터 종류
캐시에 저장할 데이터는 자주 조회되지만 변경 빈도가 낮고, 빠른 응답이 필요한 데이터가 가장 적합합니다. 캐시에 저장되는 데이터는 캐싱을 통해서 읽기 성능을 향상시키고, 서버 부하를 줄이며, 네트워크 비용을 절감할 수 있습니다.

캐시에 적합한 데이터 종류는 다음과 같습니다.
1. 자주 조회되지만 변경이 적은 데이터(읽기 중심 데이터)
	- 읽기 요청이 많고 쓰기 요청이 적은 데이터는 캐시 데이터에 적합합니다.
	- 예를 들어 상품 목록, 환율 정보, 날씨 정보, 주식 종목 기본 정보, 사용자 프로필 정보 등이 있습니다.
2. 계산 비용이 높은 데이터
	- 쿼리 실행 시간이 오래 걸리는 경우, 캐시를 활용하면 불필요한 연산을 줄일 수 있습니다.
	- 복잡한 연산을 반복하지 않기 때문에 이전 결과를 저장하여 성능을 최적화할 수 있습니다.
	- 예를 들어 다음과 같은 사례가 있습니다.
		- 자주 실행되는 데이터베이스 쿼리 결과
		- 통계 및 대시보드 데이터(예: 매출 통계, 방문자 수 집계)
3. 외부 API 응답 데이터
	- 외부 API를 호출하는 경우, 네트워크 지연과 비용을 줄이기 위해서 캐싱이 유용합니다.
	- 동일한 API를 반복적으로 호출할 필요없이 이전 응답을 캐싱하여 빠르게 제공합니다.
	- 예시
		- 환율 변환 API 결과
		- 주식 시장 지표
		- 스포츠 경기 점수 및 결과
4. 세션 및 인증 관련 데이터
	- 사용자의 로그인 상태, 세션 정보, 인증 토큰을 캐싱하여 반복적인 인증 요청을 줄이고 성능을 개선할 수 있음
	- 주로 Redis 같은 인메모리 데이터 저장소를 활용하여 빠르게 조회가 가능합니다.
	- 예시
		- JWT 캐싱
		- OAuth 토큰 캐싱
		- 웹소켓 인증키 캐싱
		- 사용자 최근 로그인 기록
5. 정적 파일 및 미디어 데이터
	- 웹사이트 정적 리소스 및 이미지, 동영상 파일을 캐싱하면 페이지 로딩 속도가 향상됩니다.
	- 보통 CDN을 활용하면 사용자와 가까운 서버에서 정적 파일을 제공합니다.
	- 예시
		- 웹사이트 이미지, 아이콘, CSS, JS파일
		- 동영상 썸네일 이미지
		- CDN을 이용한 정적 파일 배포
6. 자주 변경되지 않는 데이터 목록
	- 한번 가져오면 자주 변경되지 않고, 여러 사용자가 반복적으로 요청하는 데이터는 캐싱에 적합합니다.
	- 예시
		- 주식 종목 리스트
		- 국가 코드 및 환율 정보
		- 사용자의 포트폴리오 이름 목록
		- 자주 조회되는 뉴스 기사 목록

### 캐시에 적합하지 않는 데이터 종류
1. 실시간으로 변경되는 데이터
	- 최신 상태를 유지해야 하는 데이터는 캐싱하면 오래된 데이터(Stale Data) 문제가 발생할 수 있습니다.
	- 예시
		- 은행 계좌 잔액
		- 실시간 주문 내역
		- 실시간 주식 거래 정보
2. 개인화된 데이터
	- 사용자마다 다른 데이터를 캐싱하면 메모리 사용량이 급증하고 불필요한 데이터가 많아질 수 있습니다.
	- 캐싱보다는 데이터베이스 또는 세션 저장소 활용이 더 적합합니다.
	- 예시
		- 사용자의 장바구니 정보
		- 사용자의 주문 내역
		- 메일함 데이터
3. 민감 데이터(보안이 중요한 데이터)
	- 패스워드, 금융 거래 정보 등의 데이터를 캐싱하면 보안 위험이 증가될 수 있습니다.
	- 예시
		- 사용자 비밀번호
		- 신용카드 정보
		- 의료 데이터 정보

캐시하기에 적합한 데이터와 부적합한 데이터를 표로 정리하면 다음과 같습니다.

| 구분      | 캐싱 적합 데이터                     | 캐싱 부적합 데이터               |
| ------- | ----------------------------- | ------------------------ |
| 자주 조회됨  | 인기 뉴스 기사, 환율 정보               | 개인 이메일, 채팅 메시지           |
| 변경 빈도   | 일정 주기마다 변경되는 정보(날씨, 주식 종목 정보) | 실시간 주식 거래 데이터            |
| 연산 비용   | 데이터베이스 복잡한 쿼리 결과              | 실시간 분석 데이터               |
| 보안 중요도  | 공개 데이터(국가 코드, 상품 목록)          | 신용카드, 비밀번호               |
| 사용자별 차이 | 공통 데이터(환율, 국가 코드)             | 사용자별 맞춤 데이터(장바구니, 주문 내역) |

## 로컬 캐시 및 글로벌 캐시

### 로컬 캐시는 무엇인가?
로컬 캐시(Local Cache)는 애플리케이션이 자주 사용하는 데이터를 애플리케이션 내부의 메모리에 저장해서 동일한 데이터를 반복적으로 접근할 때 더 빠르게 데이터를 제공하는 방식입니다. 로컬 캐시 방식을 사용해서 데이터베이스나 외부 저장소에 대한 접근을 최소화해서 성능을 향상시킬 수 있습니다.

### 로컬 캐시의 특징
- 속도
	- 애플리케이션 내부에 데이터를 저장하기 때문에 데이터 접근 속도가 매우 빠릅니다.
- 단일 서버 적용
	- 각 서버 인스턴스마다 별도의 캐시를 유지하므로, 서버 간 캐시 데이터가 공유되지 않습니다.
- 메모리 사용
	- 캐시 데이터가 많아지면 애플리케이션의 메모리 사용량이 증가할 수 있습니다.

### 로컬 캐시의 장점
- 애플리케이션 내부에 저장하기 때문에 빠른 속도로 접근이 가능합니다.
- 별도 캐시 서버를 구현할 필요가 없어서 설정이 간단합니다.

### 로컬 캐시의 단점
- 서버 인스턴스마다 캐시를 별도로 관리하기 때문에 서버 간 데이터 일관성 유지가 어렵습니다.
- 애플리케이션 메모리 사용량이 증가하기 때문에 메모리 부족할 수 있습니다.

### 글로벌 캐시는 무엇인가?
글로벌 캐시(Global Cache)는 여러 서버 인스턴스가 공유하는 단일 캐시 시스템을 의미합니다. 각 서버가 독립적으로 메모리에 데이터를 저장하는 로컬 캐시와는 달리, 모든 서버가 동일한 캐시 서버를 사용하여 데이터 일관성을 유지하고 효율성을 높입니다.

### 글로벌 캐시의 특징
- 데이터 일관성 유지
	- 모든 서버가 동일한 캐시를 공유하기 때문에 모든 서버가 동일한 캐시 데이터를 사용합니다.
- 확장성
	- 트래픽 증가시 캐시 서버를 추가하여 시스템 성능을 향상시킬 수 있습니다.
- 장애 허용성
	- 하나의 캐시 서버에 장애가 발생해도 클라이언트 서버가 캐시 데이터를 제공하여 서비스의 영속성을 유지할 수 있습니다.

### 글로벌 캐시의 장점
- 데이터 일관성 유지
	- 모든 서버가 동일한 캐시를 공유하기 때문에, 한곳에서 캐시 데이터를 갱신하면 다른 서버들도 동일한 데이터를 바로 사용할 수 있습니다.
- 확장성
	- 서버가 여러대로 증가해도 하나의 캐시 저장소를 공유할 수 있어서, 수평 확장(Scale-out)이 용이합니다.
- 중앙 집중 관리
	- 캐시 관리 및 모니터링이 한곳에서 이루어지기 때문에 운영이 편합니다.
- 캐시 적중률 향상
	- 여러 서버가 동일한 데이터를 사용하기 때문에 캐시의 재사용률이 높아집니다.

### 글로벌 캐시의 단점
- 네트워크 지연
	- 캐시 서버가 네트워크를 통해 접근되므로, 로컬 캐시보다 느릴 수 있습니다.
- 복잡한 인프라
	- Redis나 Memcached 같은 외부 캐시 서버 구축이 필요하며, 고가용성, 보안, 백업 등을 추가로 고려해야 합니다.
- 의존성 증가
	- 글로벌 캐시 서버가 장애나 다운이 되면 전체 시스템 성능에 영향을 미칠 수 있습니다.

### 로컬 캐시 vs 글로벌 캐시

| 항목        | 로컬 캐시         | 글로벌 캐시        |
| --------- | ------------- | ------------- |
| 위치        | 애플리케이션 내부 메모리 | 외부 캐시 서버      |
| 속도        | 매우 빠름         | 네트워크 지연 존재 가능 |
| 데이터 공유    | 공유 불가         | 모든 서버에서 공유 가능 |
| 장애 영향     | 로컬에 국한됨       | 전체 시스템에 영향 가능 |
| 구축/운영 복잡도 | 낮음            | 높음            |

로컬 캐시에 적합한 데이터
- 변경이 드문 데이터
	- 특징: 데이터 변경 주기가 길어서 자주 갱신되지 않는 경우
	- 예시: 국가 코드, 지역 목록 등과 같이 정적이며 빈번하게 조회되는 데이터
	- 이유: 데이터 변경이 없으므로, 각 애플리케이션 각 애플리케이션의 메모리에 저장해도 데이터 일관성 문제가 발생하지 않습니다.
- 빈번하게 조회되지만 실시간성이 덜 중요한 데이터
	- 특징: 빈번하게 조회되지만, 약간의 지연이 허용되는 데이터
	- 예시: 인기 검색어 목록, 공지사항 등
	- 이유: 실시간 업데이트가 아니어도 서비스 품질에 큰 영향을 주지 않으므로 로컬 캐시에 저장하여 빠르게 제공할 수 있습니다.
- 서버별로 독립적인 데이터
	- 특징: 각 서버 인스턴스에만 사용하는 고유한 데이터
	- 예시: 서버별 설정 값이나 임시 계산 결과
	- 이유: 다른 서버와 공유할 필요가 없기 때문에 로컬 캐시에 저장하여 성능을 향상시킬 수 있습니다.

글로벌 캐시에 적합한 데이터
- 실시간성이 중요한 데이터
	- 특징: 데이터의 최신 상태가 중요하며, 모든 서버에서 동일한 데이터를 조회해야 하는 경우
	- 예시: 상품 재고 수량, 사용자 세션 정보 등
	- 이유: 모든 서버가 동일한 최신 데이터를 조회해야 하므로 글로벌 캐시를 통해서 데이터 일관성을 유지할 수 있습니다.
- 자주 변경되는 데이터
	- 특징: 데이터의 변경 빈도가 높아서 각 서버의 로컬 캐시로 관리하기 어려운 경우
	- 예시: 실시간 채팅 메시지, 주문 상태 정보 등
	- 이유: 빈번한 업데이트를 모든 서버에 반영해야 하므로 글로벌 캐시를 사용하여 데이터 동기화를 유지합니다.
- 서버 간 공유가 필요한 데이터
	- 특징: 여러 서버 인스턴스에서 공통으로 접근해야 하는 데이터
	- 예시: 공통 설정 값, 권한 정보 등
	- 이유: 모든 서버가 동일한 데이터를 참조해야 하므로 글로벌 캐시에 저장하여 일관성을 유지합니다.

캐시 위치 선택시 고려사항
- 데이터 일관성
	- 데이터 일관성이 중요한 경우 글로벌 캐시를 선택하는것을 권장합니다. 로컬 캐시는 서버별로 독립적인 데이터를 저장하므로, 데이터 일관성을 유지하기 어렵습니다.
- 성능 요구사항
	- 응답 속도가 중요한 경우 로컬 캐시를 활용하는 것을 권장합니다. 그러나 데이터 일관성이 더 중요하다면 글로벌 캐시를 선택하세요.
- 인프라 복잡도
	- 글로벌 캐시는 별도의 캐시 서버를 구축하고 관리해야 하므로 인프라 복잡도가 증가합니다. 반면, 로컬 캐시는 애플리케이션 내부의 메모리를 활용하므로 구현이 상대적으로 간단합니다.

## Cache & Data Store 배치 전략 - 읽기
### Cache Aside
**Cache Aside 패턴은 애플리케이션이 데이터를 캐시에 직접 관리하는 전략**으로, 필요한 데이터를 캐시에 로드하고 캐시되지 않은 경우 데이터 저장소에서 가져와서 캐시에 추가하는 방식입니다.
![[image-10.png]]

장점
- 읽기 서비스가 많은 경우에 적합합니다.
- Cache 서버에 장애가 발생해도 Data Store 서버를 통해서 지속 서비스를 할 수 있습니다.
- 반복적으로 동일 쿼리를 수행하는 서비스에 적합합니다.

단점
- Cache Store와 Data Store 간에 정합성 유지 문제가 발생할 수 있습니다.
- 캐시에 데이터가 없는 경우 더 오랜 시간이 걸릴 수 있습니다.


> [!NOTE] Cache Warming
> 초기에 데이터를 데이터베이스에만 저장하면 처음에는 캐시 미스(cache miss)가 많기 때문에 성능 저하의 가능성이 있습니다. 그래서 데이터베이스에서 캐시로 데이터를 미리 넣어주는 작업을 Cache Warming이라고 합니다.

### Read-Through
Read-Through 캐싱 방식은 애플리케이션이 데이터를 요청할 때, 캐시 시스템이 자동으로 데이터 저장소와 상호 작용하여 필요한 데이터를 가져오고 캐시에 저장하는 방식입니다. 이 방식에서 애플리케이션은 캐시와만 직접 통신하며, 데이터 저장소와의 상호 작용은 캐시 시스템이 처리합니다.
![[image-11.png]]

## Cache & Data Store 배치 전략 - 쓰기
### Write Back (Write Behind)
Write Back 방식은 데이터를 먼저 캐시에만 기록되고, 이후 데이터 저장소에 기록됩니다.
![[image-12.png]]

### Write Through
캐시 저장소에 데이터를 저장하고 나서 바로 데이터 저장소에서도 업데이트하는 방식입니다. 항상 동기화되고 있어서 최신 정보가 저장됩니다. 하지만 저장할때마다 2단계 과정을 거치기 때문에 속도가 상대적으로 느립니다.
![[image-13.png]]

### Write Around
데이터 쓰기 작업시 캐시를 우회하여 직접 데이터 저장소에 기록하고, 이후 해당 데이터에 대한 읽기 요청이 있을때만 캐시에 로드하는 전략입니다. 자주 읽히지 않은 데이터를 캐시에 저장하지 않기 때문에 캐시가 불필요한 데이터로 채워지는 것을 방지합니다. 쓰기 작업시에는 캐시를 거치지 않고 직접 데이터 저장소에 저장하기 때문에 쓰기 지연시간이 감소될 수 있습니다. 반면에 최근에 기록된 데이터에 대한 읽기 요청시 해당 데이터가 캐시에 없을 가능성이 높아서 데이터 저장소에 직접 가져와야 하므로 지연시간이 증가될 수 있습니다. 그리고 데이터 저장소의 데이터가 변경되었지만 캐시가 이를 반영하지 못하면, 오래된 데이터를 반환할 수 있으므로, 적절한 캐시 무효화 전략이 필요합니다.
![[image-14.png]]


## References
- https://kk-programming.tistory.com/83