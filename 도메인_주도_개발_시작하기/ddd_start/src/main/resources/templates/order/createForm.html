<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Create Order</title>

    <script>
        let productIndex = 1;

        function addProduct() {
            const container = document.getElementById("orderProducts");
            const template = document.getElementById("productTemplate").innerHTML;

            // __index__ 를 현재 인덱스로 교체
            const newProductForm = template.replace(/__index__/g, productIndex);
            const wrapper = document.createElement("div");
            wrapper.classList.add("order-product");
            wrapper.innerHTML = newProductForm;

            container.appendChild(wrapper);
            productIndex++;
        }
    </script>
</head>
<body>
<h1>Order Create Form</h1>
<form action="/order/place" method="post">
    <label for="orderProducts">Order Products:</label>
    <div id="orderProducts">
        <!-- 기본 하나는 표시 -->
        <div class="order-product">
            <label>Product:</label>
            <select name="orderProducts[0].productId" required>
                <option value="">-- Select Product --</option>
                <th:block th:each="product : ${products}">
                    <option th:value="${product.productId}"
                            th:text="${product.productName}"></option>
                </th:block>
            </select>
            <br>

            <label>Quantity:</label>
            <input type="number" name="orderProducts[0].quantity" min="1" required>
            <br><br>
        </div>
    </div>
    <div id="productTemplate" style="display:none;">
        <label>Product:</label>
        <select name="orderProducts[__index__].productId" required>
            <option value="">-- Select Product --</option>
            <th:block th:each="product : ${products}">
                <option th:value="${product.productId}"
                        th:text="${product.productName}"></option>
            </th:block>
        </select>
        <br>
        <label>Quantity:</label>
        <input type="number" name="orderProducts[__index__].quantity" min="1" required>
        <br><br>
    </div>
    <button type="button" onclick="addProduct()">➕ Add Product</button>
    <br><br>

    <label for="ordererMemberId">Orderer Member ID:</label>
    <input type="hidden" id="ordererMemberId" name="ordererMemberId" th:value="${ordererMemberId}">
    <br>

    <label for="shippingInfo">Shipping Info</label>
    <br>
    <div id="shippingInfo">
        <label for="receiverName">Receiver Name:</label>
        <input type="text" id="receiverName" name="receiverName" th:value="${receiverName}" required>
        <br>

        <label for="receiverPhone">Receiver Phone:</label>
        <input type="text" id="receiverPhone" name="receiverPhone" required>
        <br>

        <label for="message">Message:</label>
        <input type="text" id="message" name="message">
        <br>

        <label for="address1">Address Line 1:</label>
        <input type="text" id="address1" name="address1" th:value="${address1}" required>
        <br>

        <label for="address2">Address Line 2:</label>
        <input type="text" id="address2" name="address2" th:value="${address2}">
        <br>

        <label for="zipcode">Zipcode:</label>
        <input type="text" id="zipcode" name="zipcode" th:value="${zipcode}" required>
    </div>
    <br>

    <button type="submit">Create Order</button>
</form>
</body>
</html>
